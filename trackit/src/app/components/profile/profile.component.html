<div class="profile-container">
    <!-- Header -->
    <div class="profile-header" fxLayout="row" fxLayout.xs="column" fxLayoutAlign="start center" fxLayoutGap="24px">
      <div class="profile-avatar">
        {{ getUserInitials() }}
      </div>
      <div class="profile-info">
        <h2>{{ currentUser?.firstName }} {{ currentUser?.lastName }}</h2>
        <p class="profile-email">{{ currentUser?.email }}</p>
        <p class="profile-join-date">Member since {{ getJoinDate() }}</p>
      </div>
    </div>
  
    <!-- Profile Settings -->
    <div class="profile-content" fxLayout="row" fxLayout.xs="column" fxLayoutGap="24px">
      <!-- Personal Information -->
      <mat-card class="profile-card" fxFlex="50" fxFlex.xs="100">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>person</mat-icon>
            Personal Information
          </mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" placeholder="Enter your first name">
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="profileForm.get('firstName')?.hasError('required')">
                First name is required
              </mat-error>
              <mat-error *ngIf="profileForm.get('firstName')?.hasError('minlength')">
                First name must be at least 2 characters
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" placeholder="Enter your last name">
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="profileForm.get('lastName')?.hasError('required')">
                Last name is required
              </mat-error>
              <mat-error *ngIf="profileForm.get('lastName')?.hasError('minlength')">
                Last name must be at least 2 characters
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="Enter your email">
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="profileForm.get('email')?.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="profileForm.get('email')?.hasError('email')">
                Please enter a valid email
              </mat-error>
            </mat-form-field>
  
            <button mat-raised-button color="primary" type="submit" 
                    class="full-width" [disabled]="!profileForm.valid || isLoading">
              <span *ngIf="!isLoading">
                <mat-icon>save</mat-icon>
                Update Profile
              </span>
              <span *ngIf="isLoading">
                <mat-spinner diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
                Updating...
              </span>
            </button>
          </form>
        </mat-card-content>
      </mat-card>
  
      <!-- Change Password -->
      <mat-card class="profile-card" fxFlex="50" fxFlex.xs="100">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>lock</mat-icon>
            Change Password
          </mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Current Password</mat-label>
              <input matInput [type]="hideCurrentPassword ? 'password' : 'text'" 
                     formControlName="currentPassword" placeholder="Enter current password">
              <button mat-icon-button matSuffix (click)="hideCurrentPassword = !hideCurrentPassword" 
                      [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hideCurrentPassword" type="button">
                <mat-icon>{{hideCurrentPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.get('currentPassword')?.hasError('required')">
                Current password is required
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>New Password</mat-label>
              <input matInput [type]="hideNewPassword ? 'password' : 'text'" 
                     formControlName="newPassword" placeholder="Enter new password">
              <button mat-icon-button matSuffix (click)="hideNewPassword = !hideNewPassword" 
                      [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hideNewPassword" type="button">
                <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
                New password is required
              </mat-error>
              <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
                Password must be at least 6 characters
              </mat-error>
              <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('passwordStrength')">
                Password must contain uppercase, lowercase, number and special character
              </mat-error>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirm New Password</mat-label>
              <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" 
                     formControlName="confirmPassword" placeholder="Confirm new password">
              <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" 
                      [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hideConfirmPassword" type="button">
                <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">
                Please confirm your new password
              </mat-error>
              <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('passwordMismatch')">
                Passwords do not match
              </mat-error>
            </mat-form-field>
  
            <button mat-raised-button color="accent" type="submit" 
                    class="full-width" [disabled]="!passwordForm.valid || isUpdatingPassword">
              <span *ngIf="!isUpdatingPassword">
                <mat-icon>security</mat-icon>
                Change Password
              </span>
              <span *ngIf="isUpdatingPassword">
                <mat-spinner diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
                Changing...
              </span>
            </button>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  
    <!-- Account Statistics -->
    <mat-card class="stats-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>analytics</mat-icon>
          Account Statistics
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="stats-grid" fxLayout="row" fxLayout.xs="column" fxLayoutGap="24px">
          <div class="stat-item" fxFlex="25" fxFlex.xs="100">
            <mat-icon class="stat-icon">receipt_long</mat-icon>
            <div class="stat-info">
              <h3>Total Expenses</h3>
              <p>Coming Soon</p>
            </div>
          </div>
          
          <div class="stat-item" fxFlex="25" fxFlex.xs="100">
            <mat-icon class="stat-icon">category</mat-icon>
            <div class="stat-info">
              <h3>Categories Used</h3>
              <p>Coming Soon</p>
            </div>
          </div>
          
          <div class="stat-item" fxFlex="25" fxFlex.xs="100">
            <mat-icon class="stat-icon">trending_up</mat-icon>
            <div class="stat-info">
              <h3>This Month</h3>
              <p>Coming Soon</p>
            </div>
          </div>
          
          <div class="stat-item" fxFlex="25" fxFlex.xs="100">
            <mat-icon class="stat-icon">savings</mat-icon>
            <div class="stat-info">
              <h3>Average/Month</h3>
              <p>Coming Soon</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>